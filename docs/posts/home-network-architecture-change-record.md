---
title: 家庭网络架构变更记录
date: 2025-06-10T06:19:22.346Z
categories: ['other']
---

刚给家里网络接入了一台软路由，升级了一下网络体验。
<!-- more -->

今年折腾了几次网络，目前应该是最终形态，满足家庭网络需求。

以下是我的家庭网络折腾过程，希望可以给你一些参考。


## 第一阶段，能上网就行
目前大多数家庭采用的网络部署方式为：宽带安装人员上门完成光猫设备调试后，用户通过两种方式接入网络：
1. 无线路由器连接光猫实现 Wi-Fi 覆盖；
2. 通过网线将电脑等设备直接有线接入光猫（或路由器）实现有线上网。

正常用是没有任何问题的，只是当你有多设备想内网互相访问时，可能会遇到问题。首先要确定的是光猫是否在**拨号模式**，如果是的话，那么路由器基本就是 `DHCP`模式，我家开始就是这样的模式。这样的组网方式会带来一个问题，就是光猫与路由器各自独立提供 `DHCP` 服务，导致两类设备下的终端分配到的 IP 地址**不属于同一网段**：
- 光猫直连设备：由光猫 DHCP 服务分配 IP，形成独立子网（如 192.168.1.x 网段）；
- 路由器下联设备：由路由器 DHCP 服务分配 IP，形成另一子网（如 192.168.0.x 网段）。

网段不同的设备，肯定是无法内网互访的，举个例子就是我有线连接光猫的电脑，无法访问路由器的管理后台。所以为了全屋设备可以统一网段，我进行到了第二阶段的改造。

## 第二阶段，统一设备网段
有些家庭网络，可能初始时就是这个模式。要想统一联网设备的 IP 网段，其实就两种方法，要么全部用光猫分配 IP，要么全用路由器分配 IP。

### 光猫拨号，路由器改桥接（AP）

全部用光猫来分配IP，那么光猫需要是拨号模式。怎么确定是不是光猫拨号呢？用一根网线连接光猫和电脑，电脑可以上网的就代表光猫是拨号模式。

此时光猫已经具有了`DHCP` 服务，那么就需要关闭路由器的 `DHCP`，将路由器连接上光猫，然后进入路由器后台，将上网方式设置成`桥接（Bridge）`，这个在每个路由器后台的显示名称可能不一样，可能叫 `AP模式`或者`中继模式`，要自行判断。

此模式下光猫承担了光电信号转换以及路由功能，而路由器只是分发了无线信号，好处就是你可以连接多个路由器，将无线信号覆盖全屋，坏处就是光猫性能不如路由器，承担太多会导致发热严重，造成网络不稳或卡顿。所以可以考虑让路由器来拨号上网。

### 光猫改桥接，路由器拨号
检查你的光猫，如果直接连接光猫无法上网的话，那么光猫基本就是桥接模式了。所谓光猫桥接，就是光猫只作为光电信号的转换设备，不再承担路由功能，而是将网络信号“透传”给后端的路由器或者交换机，由这些设备负责拨号上网和分配 IP。

> 如果光猫不是桥接模式，就需要改成桥接，但是改光猫就没有改路由器简单了。如果自己修改，需要运营商提供光猫后台的超级密码，运气好的话，你能够找客服人员或者宽带安装人员要到，然后找教程自行修改。运气不好的话，你不仅要不到超级密码，甚至找不到运营商的人帮你改。而我就是运气不好的，找移动客服好几次，要么说不知道，要么说不能改，要么说需要自己改但是没有超级密码。找安装宽带的小哥，他说也没有密码，也进不去光猫后台。走途无路之下，找了淘宝，35块钱帮我远程破解了光猫，改成了桥接模式，顺便把超级账户和密码也破解给我了，顺便关闭了运营商的远程控制。如果你也苦于无法光猫改桥接，希望可以给你参考。

确认光猫改成桥接模式后就简单了，连接上路由器，登录路由器后台将上网方式设置成`拨号上网（PPPoE）`。此时所有连接在路由器上设备，都可以内网互访了，并且现在的路由器性能都比较好，一定程度上是比光猫拨号稳定的。但看似完美的方案，其实也会有新的难题，看你是否中招。

## 第三阶段，有线回程或者单线复用

大多数家庭的网线埋线，是各房间都拉一根网线集中到弱电箱中，然后插到光猫上联网。但光猫改桥接后，是无法提供网络的，想要上网就需要将网线插到路由器上。

如果你的弱电箱比较大，或者是放在柜子里的，有空间，那么可以将路由器也放在弱电箱这边接入网线，就是箱柜里散热不好解决。

如果你的弱电箱很小，不能再放入路由器了，那么你的路由器大概率是会放到客厅电视柜，然后通过埋线连接到光猫上。事实上即使弱电箱有空间，很多人还是喜欢将路由器放在客厅电视柜位置，比较居中的位置，信号覆盖会好很多，而且开放空间也有利于散热。

假设你的路由器必须放在客厅电视柜，那么问题就来了，你怎么让其他房间的网络设备有线连接到你的路由器呢？或者你家里面积大，各房间路由器怎么有线 Mesh 组网呢？

### 有线回程
如果你当初装修时，给你埋线的师傅有经验，那么肯定会建议你埋两根网线或者三根网线到客厅电视柜，而我就没有遇到这种师傅，自己又没想多，就给我埋了一根网线到客厅电视柜。

为什么需要两根网线呢？因为这样路由器就可以通过第二根网线，将网络信号回程到弱电箱，接到弱电箱的交换机上，就可以将各房间网线插在这个交换机上进行上网了。

> 什么是交换机？可以理解为快递站中的快递分拣员，记住每个收件人（设备）的地址（MAC地址），包裹（数据包）来了直接送到对应地址，不打扰其他人。交换机可以将多个设备连接，实现互通。

此时你只需要买一个交换机放在弱电箱就行，这个省不掉，因为没有交换机的话，弱电箱的网线没有地方接入了。如果此时所有连接的路由器是一个品牌的，还可以做成有线Mesh 组网，让你的大别野也可以无缝切换信号上网。

### 单线复用
如果你客厅电视柜只有一根网线咋办？巧了，我就是客厅只有一根网线到弱电箱。此时要么找人再拉一根网线，要么就考虑单线复用了。

单线复用的原理很简单，两台交换机之间用一根网线连接，这样两个交换机上的设备是互通的。我们在电视柜和弱电箱分别加一个交换机，信号传递方向是：`光猫桥接=>交换机1=>到客厅的网线=>交换机2=>路由器拨号=>交换机2=>客厅网线=>交换机1=>插在交换机1上的其他网线`。这里只是简单的流程，需要注意的问题：
- 光猫需要桥接，这个不用多说，因为要用路由器拨号；
- 预埋到电视柜的网线最好是5类以上，且8芯全通，不然即使千兆也会将为百兆；
- 路由器的`WAN`口和`LAN`口要分别插在客厅交换机的不同网口，进是`WAN`口，出是 `LAN`口；
- 如果需要`IPTV`功能，需要买带网管功能的交换机，用于划分 `VLAN`，可以理解为虚拟隔离各网络连接，避免互相干扰。

单线复用设置好的话，并不会带来很大的带宽损耗，千兆及以内可以无感。当你别无选择时，可以考虑单线复用，需要两台交换机，加上一定的网络知识。

我这里不再多介绍单线复用的具体实现，因为我最后放弃了这种方式，选择了一个更简单的方案。

## 现阶段
我现在的网络方案，正如开头说的，我在网络架构中接入了一台交换机。上面的第一和第二阶段，都是我经历过的，第三阶段的方案我只是规划过，但是最后都没应用。这里要捋一下我的需求：
- 我需要全屋设备统一内网网段，实现任意联网设备的内网互访；
- 我需要将路由器放在客厅电视柜，这样无线信号覆盖好，同时有利于路由器散热；
- 我家客厅电视柜与弱电箱之间只埋了一根网线，而我又需要将路由器拨号的信号传递到全屋，这样我能用的方式只有单线复用。

单线复用看似是我唯一的选择，但还有种更简单的方式更适合我，就是直接在弱电箱再加一个路由器。前面说了在弱电箱放路由器会影响信号及散热，但是我家的弱电箱在柜子中，空间比较大，这解决了没地方放路由器以及散热问题（空间大，散热稍好，也可以加风扇）。然后信号问题更不用担心，因为我不用弱电箱路由器的无线信号就好，关掉这个路由器的无线功能，只做拨号就行了。所以我的方案是：
- 买一个软路由，不带无线功能，性能够强，作为主路由放在弱电箱拨号；
- 弱电箱中所有房间的网线都接入软路由即可，统一的网段；
- 电视柜路由器也接入软路由，并改成 AP 模式，将软路由的信号进行无线覆盖。

这个方案基本完美解决了我的需求，且软路由的可玩性高很多，后期可以实现很多功能，例如全屋科学上网。

## 总结
以上就是我的家庭网络改造过程，希望对你有帮助。后期准备补上图片以便理解。